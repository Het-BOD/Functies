## Libraries laden -----------------------------------------------------------------------
library(RSelenium)
library(XML)
library(tidyverse)
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
#Stap 1: Run the Selenium Server and connect to it -----------------------------------------------------------------------
rds  <- rsDriver(browser=c("chrome"), chromever = "91.0.4472.19")
remDr <- rds$client
## Libraries laden -----------------------------------------------------------------------
library(RSelenium)
library(XML)
library(tidyverse)
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
#Nagiveer naar de gewenste website -----------------------------------------------------------------------
remDr$navigate("https://samenpartner.gelderland.nl/Login.aspx")
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
#Stap 1: Run the Selenium Server and connect to it -----------------------------------------------------------------------
rds  <- rsDriver(browser=c("chrome"), chromever = "91.0.4472.19")
remDr <- rds$client
#Nagiveer naar de gewenste website -----------------------------------------------------------------------
remDr$navigate("https://samenpartner.gelderland.nl/Login.aspx")
remDr$getTitle()
remDr$getStatus()
#Zoek naar de specifieke elementen waar je text wilt invoeren of een mouseclick op wilt uitvoeren
#Let op het verschil tussen find element en find elements!!
#Naar een bepaald element gaan door te zoeken op ID (kan ook op class of xpath)
emailbox <- remDr$findElement(using = 'id', value = "LoginControl_UserName")
emailbox$getElementAttribute("id")
emailbox$getElementAttribute("class")
emailbox$sendKeysToElement(list("ekramer"))
passwordbox <- remDr$findElement(using = 'id', value = "LoginControl_Password")
passwordbox$getElementAttribute("id")
passwordbox$getElementAttribute("class")
passwordbox$sendKeysToElement(list("S@menBOD1!"))
inlogbutton <- remDr$findElement(using = 'name', value= "LoginControl$LoginButton")
inlogbutton$getElementAttribute("id")
inlogbutton$getElementAttribute("class")
inlogbutton$clickElement()
#Alleen eigen regio uitvinken
regiobutton <- remDr$findElement(using = 'id', value= "ContentPlaceHolder1_chkAlleenEigenRegio")
regiobutton$getElementAttribute("id")
regiobutton$getElementAttribute("class")
regiobutton$clickElement()
#Headers ophalen om vervolgens een lege tabel te specificeren en te loopen over pagina's  -----------------------------------------------------------------------
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
xmlcode
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .[9:19,]
data_totaal <- data.frame(matrix(ncol=11, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(2:10)
#Op iedere pagina zijn de relevante regels rijen 3 tot en met 16 in de tabel
rows <- c(3:16)
pages <- c(2:10)
pages <- c(1:10)
for (p in pages){
for (x in rows){
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode, paste0('///*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[', x, "]")))
emptycols <- colSums(databody_pagex == " ") == nrow(databody_pagex)
databody_pagex <- databody_pagex[!emptycols]
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
}
nextpage <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[', p, ']/a', sep=""))
nextpage$getElementAttribute("id")
nextpage$getElementAttribute("class")
nextpage$clickElement()
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
}
pages <- c(2:10)
pages <- c(2:10)
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .[9:19,]
data_totaal <- data.frame(matrix(ncol=11, nrow=0)); colnames(data_totaal) <- datahead
#Op iedere pagina zijn de relevante regels rijen 3 tot en met 16 in de tabel
rows <- c(3:16)
pages <- c(2:10)
for (p in pages){
for (x in rows){
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode, paste0('///*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[', x, "]")))
emptycols <- colSums(databody_pagex == " ") == nrow(databody_pagex)
databody_pagex <- databody_pagex[!emptycols]
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
}
nextpage <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[', p, ']/a', sep=""))
nextpage$getElementAttribute("id")
nextpage$getElementAttribute("class")
nextpage$clickElement()
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
}
View(data_totaal)
View(data_totaal)
#Op iedere pagina zijn de relevante regels rijen 3 tot en met 16 in de tabel
rows <- c(3:16)
pages <- c(2:11)
for (p in pages){
for (x in rows){
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode, paste0('///*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[', x, "]")))
emptycols <- colSums(databody_pagex == " ") == nrow(databody_pagex)
databody_pagex <- databody_pagex[!emptycols]
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
}
nextpage <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[', p, ']/a', sep=""))
nextpage$getElementAttribute("id")
nextpage$getElementAttribute("class")
nextpage$clickElement()
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
}
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .[9:19,]
data_totaal <- data.frame(matrix(ncol=11, nrow=0)); colnames(data_totaal) <- datahead
#Op iedere pagina zijn de relevante regels rijen 3 tot en met 16 in de tabel
rows <- c(3:16)
pages <- c(2:11)
for (p in pages){
for (x in rows){
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode, paste0('///*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[', x, "]")))
emptycols <- colSums(databody_pagex == " ") == nrow(databody_pagex)
databody_pagex <- databody_pagex[!emptycols]
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
}
nextpage <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[', p, ']/a', sep=""))
nextpage$getElementAttribute("id")
nextpage$getElementAttribute("class")
nextpage$clickElement()
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
}
View(data_totaal)
#Met onderstaand pijltje ga je naar de volgende set aan paginanummers
pijltje <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[12]/a'))
pijltje$getElementAttribute("id")
pijltje$getElementAttribute("class")
pijltje$clickElement()
pages2 <- c(11:15)
for (p in pages2){
for (x in rows){
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode, paste0('///*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[', x, "]")))
emptycols <- colSums(databody_pagex == " ") == nrow(databody_pagex)
databody_pagex <- databody_pagex[!emptycols]
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
}
nextpage <- remDr$findElement(using = 'xpath', value= paste0('//*[@id="ContentPlaceHolder1_dgrKlachten"]/tbody/tr[1]/td/table/tbody/tr/td[', p, ']/a', sep=""))
nextpage$getElementAttribute("id")
nextpage$getElementAttribute("class")
nextpage$clickElement()
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
}
View(databody_pagex)
## Libraries laden -----------------------------------------------------------------------
library(RSelenium)
library(XML)
library(tidyverse)
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
#Stap 1: Run the Selenium Server and connect to it -----------------------------------------------------------------------
rds  <- rsDriver(browser=c("chrome"), chromever = "91.0.4472.19")
remDr <- rds$client
#Nagiveer naar de gewenste website -----------------------------------------------------------------------
remDr$navigate("https://samenpartner.gelderland.nl/Login.aspx")
remDr$getTitle()
remDr$getStatus()
#Zoek naar de specifieke elementen waar je text wilt invoeren of een mouseclick op wilt uitvoeren
#Let op het verschil tussen find element en find elements!!
#Naar een bepaald element gaan door te zoeken op ID (kan ook op class of xpath)
emailbox <- remDr$findElement(using = 'id', value = "LoginControl_UserName")
emailbox$getElementAttribute("id")
emailbox$getElementAttribute("class")
emailbox$sendKeysToElement(list("ekramer"))
passwordbox <- remDr$findElement(using = 'id', value = "LoginControl_Password")
passwordbox$getElementAttribute("id")
passwordbox$getElementAttribute("class")
passwordbox$sendKeysToElement(list("S@menBOD1!"))
inlogbutton <- remDr$findElement(using = 'name', value= "LoginControl$LoginButton")
inlogbutton$getElementAttribute("id")
inlogbutton$getElementAttribute("class")
inlogbutton$clickElement()
#Alleen eigen regio uitvinken
regiobutton <- remDr$findElement(using = 'id', value= "ContentPlaceHolder1_chkAlleenEigenRegio")
regiobutton$getElementAttribute("id")
regiobutton$getElementAttribute("class")
regiobutton$clickElement()
source('~/8. Algemene scripts/Scrapen_scheduled_tasks/AFAS script.R', echo=TRUE)
shiny::runApp('Test_dashboard/Test_app_EK')
library(shiny)
library(DT)
library(AzureStor)
library(tidyverse)
#Data ophalen uit storage account
blob_endp <- blob_endpoint("https://rgomwbdscodiag.blob.core.windows.net",
key="RSvNvCZtNm0VjNXez8CqnA/gAd8KjsQRxWlOxmNJxGGUY5PHhdjjvhHZLepzd5I4gGLTfxHgBbVN7xC/sM+r5Q==")
runApp('Test_dashboard/Test_app_EK')
#Data ophalen uit storage account
blob_endp <- blob_endpoint("https://rgomwbdscodiag.blob.core.windows.net",
key="RSvNvCZtNm0VjNXez8CqnA/gAd8KjsQRxWlOxmNJxGGUY5PHhdjjvhHZLepzd5I4gGLTfxHgBbVN7xC/sM+r5Q==")
klachtendata_cont <- blob_endp %>% blob_container("klachtendata")
klachtendata_df <- storage_read_csv2(klachtendata_cont, "samen_test.csv") %>%
mutate(Datum = substring(klachtendata_df$DatumTijdMelding,1,10),
Datum = as.Date(Datum, format = "%Y-%m-%d")) %>%
relocate(Datum)
klachtendata_df <- storage_read_csv2(klachtendata_cont, "samen_test.csv")# %>%
View(klachtendata_df)
runApp('Test_dashboard/Test_app_EK')
klachtendata_df <- storage_read_csv2(klachtendata_cont, "samen_test.csv") %>%
mutate(Datum = substring(klachtendata_df$DatumTijdMelding,1,10),
Datum = as.Date(Datum, format = "%Y-%m-%d")) %>%
relocate(Datum)
#Dashboard update datum is de datum van vandaag, die wordt dus opgehaald als het script draait
Updatedashboarddatum <- format(Sys.Date(), "%d-%m-%Y")
Scrapedatum <- max(klachtendata_df$Datum) %>% format("%d-%m-%Y")
# UI
ui <- fluidPage(
titlePanel("Test app"),
h1(paste0("Dit dashboard is voor het laatst geupdate op ", Updatedashboarddatum, sep="")),
h2(paste0("De KIWA data is voor het laatst geupdate op ", Scrapedatum, sep="")),
DT::dataTableOutput("summary"))
# SERVER
server <- function(input, output) {
output$summary <- DT::renderDataTable(klachtendata_df)
}
print(paste0(Sys.Date(), ": Dit script heeft gerund", sep=""))
# Run the application
shinyApp(ui = ui, server = server)

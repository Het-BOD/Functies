shiny::runApp()
#Datum van bestand ophalen
Scrapedatum <- format(file.info("/KIWA_data_gescraped_2020-10-05.csv")$mtime, "%d-%m-%Y")
#Datum van bestand ophalen
Scrapedatum <- format(file.info("test/KIWA_data_gescraped_2020-10-05.csv")$mtime, "%d-%m-%Y")
#Datum van bestand ophalen
Scrapedatum <- format(file.info("data/KIWA_data_gescraped_2020-10-05.csv")$mtime, "%d-%m-%Y")
runApp()
runApp()
runApp()
runApp()
test <- read.csv("KIWA_data_gescraped_2020-10-05.csv")
runApp()
max(test$Scrapedatum)
View(test)
test <- read.csv("KIWA_data_gescraped_2020-23-10.csv")
test <- read.csv("KIWA_data_gescraped_2020-23-10.csv")
test <- read.csv("data/KIWA_data_gescraped_2020-23-10.csv")
test <- read.csv("data/KIWA_data_gescraped_2020-10-23.csv")
runApp()
max(test$Scrapedatum)
View(test)
runApp()
runApp()
test <- read.csv("data/KIWA_data_gescraped_2020-10-23.csv")
max(test$Scrapedatum)
runApp()
runApp()
test <- read.csv(paste0("data/KIWA_data_gescraped_", Sys.Date(),".csv", sep=""))
test <- read.csv(paste0("data/KIWA_data_gescraped_", Sys.Date(),".csv", sep=""))
taskscheduler_delete("update_test_dashboard")
## Libraries laden -----------------------------------------------------------------------
library(taskscheduleR)
taskscheduler_delete("update_test_dashboard")
rscript2 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Automatische_update_test_app.R"
taskscheduler_create(taskname = "update_test_dashboard", rscript = rscript2,
schedule = "DAILY",
starttime = "09:15",
startdate = format(Sys.Date(), "%d/%m/%Y"))
## 0. Libraries laden -----------------------------------------------------------------------
library(RSelenium)
library(XML)
library(tidyverse)
library(netstat)
library(lubridate)
#Je moet hiervoor al een webdriver voor chrome installeren/downloaden
## 1. Run the Selenium Server and connect to it -----------------------------------------------------------------------
rds  <- rsDriver(browser=c("chrome"), chromever = "85.0.4183.87", port = 14415L)
remDr <- rds$client
## 2. Nagiveer naar de gewenste website -----------------------------------------------------------------------
remDr$navigate("https://dataportal.kiwa.info/site/login")
remDr$getTitle()
remDr$getStatus()
#Zoek naar de specifieke elementen waar je text wilt invoeren of een mouseclick op wilt uitvoeren
#Let op het verschil tussen find element en find elements!!
#Naar een bepaald element gaan door te zoeken op ID (kan ook op class of xpath)
emailbox <- remDr$findElement(using = 'id', value = "loginform-username")
emailbox$getElementAttribute("id")
emailbox$getElementAttribute("class")
emailbox$sendKeysToElement(list("jeroen.bax@odzob.nl"))
passwordbox <- remDr$findElement(using = 'id', value = "loginform-password")
passwordbox$getElementAttribute("id")
passwordbox$getElementAttribute("class")
passwordbox$sendKeysToElement(list("R000153330"))
inlogbutton <- remDr$findElement(using = 'name', value= "login-button")
inlogbutton$getElementAttribute("id")
inlogbutton$getElementAttribute("class")
inlogbutton$clickElement()
remDr$getCurrentUrl()
remDr$navigate("https://dataportal.kiwa.info/project")
remDr$getCurrentUrl()
#Huidige dataset inladen, in de loop is ingebouwd dat hij stopt met rbinden als er dubbele records inzitten
datum <- ifelse((wday(Sys.Date(), week_start = getOption("lubridate.week.start", 1)) == 1),
Sys.Date() -3, Sys.Date() -1) %>% as.Date(., origin = "1970-01-01")
huidig <- readRDS(paste0("data/KIWA_data_gescraped_", datum, ".rds", sep="")) %>% select(-Scrapedatum)
length(unique(huidig$`Certificaat nr`)) == nrow(huidig)
data_totaal <- huidig[11:4000,]
datahead <- names(data_totaal)
# data_totaal <- data.frame(matrix(ncol=9, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(1:10)
for (x in pages) {
#Naar de pagina gaan
remDr$navigate(paste0("https://dataportal.kiwa.info/project/index?page=", x))
print(remDr$getCurrentUrl())
##Tabel scrapen en toevoegen aan data_totaal
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//thead/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .$colnames
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr"))
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
print(nrow(unique((data_totaal))))
print(nrow((data_totaal)))
if(nrow(unique(data_totaal)) < nrow(data_totaal)) {
break
}
}
data_totaal <- data_totaal %>% unique()
huidig2 <- readRDS(paste0("data/KIWA_data_gescraped_", datum, ".rds", sep=""))
huidig <- huidig2 %>% select(-Scrapedatum)
huidig <- huidig2 %>% select(-Scrapedatum)
length(unique(huidig$`Certificaat nr`)) == nrow(huidig)
data_totaal <- huidig[11:4000,]
datahead <- names(data_totaal)
huidig2 <- huidig2 %>% select(`Certificaat nr`, Scrapedatum)
View(huidig2)
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Scrapedatum")
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr")
View(data_totaal)
data_totaal <- huidig[11:4000,]
datahead <- names(data_totaal)
huidig2 <- huidig2 %>% select(`Certificaat nr`, Scrapedatum)
# data_totaal <- data.frame(matrix(ncol=9, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(1:10)
for (x in pages) {
#Naar de pagina gaan
remDr$navigate(paste0("https://dataportal.kiwa.info/project/index?page=", x))
print(remDr$getCurrentUrl())
##Tabel scrapen en toevoegen aan data_totaal
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//thead/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .$colnames
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr"))
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
print(nrow(unique((data_totaal))))
print(nrow((data_totaal)))
if(nrow(unique(data_totaal)) < nrow(data_totaal)) {
break
}
}
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr")
View(data_totaal)
huidig2 <- huidig2[11:4000,] %>% select(`Certificaat nr`, Scrapedatum)
data_totaal <- huidig[11:4000,]
datahead <- names(data_totaal)
huidig2 <- huidig2[11:4000,] %>% select(`Certificaat nr`, Scrapedatum)
# data_totaal <- data.frame(matrix(ncol=9, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(1:10)
for (x in pages) {
#Naar de pagina gaan
remDr$navigate(paste0("https://dataportal.kiwa.info/project/index?page=", x))
print(remDr$getCurrentUrl())
##Tabel scrapen en toevoegen aan data_totaal
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//thead/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .$colnames
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr"))
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
print(nrow(unique((data_totaal))))
print(nrow((data_totaal)))
if(nrow(unique(data_totaal)) < nrow(data_totaal)) {
break
}
}
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr")
View(data_totaal)
huidig <- huidig[11:4000,]
View(huidig)
View(data_totaal)
View(huidig)
View(huidig2)
#Huidige dataset inladen, in de loop is ingebouwd dat hij stopt met rbinden als er dubbele records inzitten
datum <- ifelse((wday(Sys.Date(), week_start = getOption("lubridate.week.start", 1)) == 1),
Sys.Date() -3, Sys.Date() -1) %>% as.Date(., origin = "1970-01-01")
huidig2 <- readRDS(paste0("data/KIWA_data_gescraped_", datum, ".rds", sep=""))
huidig <- huidig2 %>% select(-Scrapedatum)
length(unique(huidig$`Certificaat nr`)) == nrow(huidig)
huidig <- huidig[11:4000,]
data_totaal <- huidig
datahead <- names(data_totaal)
huidig2 <- huidig2[11:4000,] %>% select(`Certificaat nr`, Scrapedatum)
# data_totaal <- data.frame(matrix(ncol=9, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(1:10)
for (x in pages) {
#Naar de pagina gaan
remDr$navigate(paste0("https://dataportal.kiwa.info/project/index?page=", x))
print(remDr$getCurrentUrl())
##Tabel scrapen en toevoegen aan data_totaal
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//thead/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .$colnames
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr"))
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
print(nrow(unique((data_totaal))))
print(nrow((data_totaal)))
if(nrow(unique(data_totaal)) < nrow(data_totaal)) {
break
}
}
View(data_totaal)
length(unique(data_totaal$`Certificaat nr`))
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr")
View(data_totaal)
data_totaal <- huidig
datahead <- names(data_totaal)
huidig2 <- huidig2[11:4000,] %>% select(`Certificaat nr`, Scrapedatum)
# data_totaal <- data.frame(matrix(ncol=9, nrow=0)); colnames(data_totaal) <- datahead
pages <- c(1:10)
for (x in pages) {
#Naar de pagina gaan
remDr$navigate(paste0("https://dataportal.kiwa.info/project/index?page=", x))
print(remDr$getCurrentUrl())
##Tabel scrapen en toevoegen aan data_totaal
xmlcode <- htmlParse(remDr$getPageSource()[[1]])
datahead <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//thead/tr/th")) %>% mutate(colnames=ifelse(is.na(a), text, a)) %>% select(colnames) %>% .$colnames
databody_pagex <- xmlToDataFrame(nodes=getNodeSet(xmlcode,"//tbody/tr"))
colnames(databody_pagex) <- datahead
data_totaal <- rbind(data_totaal, databody_pagex)
print(nrow(unique((data_totaal))))
print(nrow((data_totaal)))
if(nrow(unique(data_totaal)) < nrow(data_totaal)) {
break
}
}
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr") %>%
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr") %>%
mutate(Scrapedatum = ifelse(is.na(Scrapedatum), format(Sys.Date(), "%d-%m-%Y"), Scrapedatum))
data_totaal <- data_totaal %>% unique() %>% left_join(huidig2, by = "Certificaat nr") %>%
mutate(Scrapedatum = ifelse(is.na(Scrapedatum), format(Sys.Date(), "%d-%m-%Y"), Scrapedatum))
table(data_totaal$Scrapedatum)
View(data_totaal)
write.csv(data_totaal, paste0("C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/KIWA_data_gescraped_", Sys.Date(), ".csv"), row.names=FALSE)
write_rds(data_totaal, paste0("C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/KIWA_data_gescraped_", Sys.Date(), ".rds"))
print(paste0(Sys.Date(), ": Dit script heeft gerund", sep=""))
shiny::runApp()
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA.R"
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA_dagelijks.R"
taskscheduler_create(taskname = "run_scrapen_KIWA", rscript = rscript1,
schedule = "DAILY",
starttime = "09:05",
startdate = format(Sys.Date()+1, "%d/%m/%Y"))
## Libraries laden -----------------------------------------------------------------------
library(taskscheduleR)
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA_dagelijks.R"
taskscheduler_create(taskname = "run_scrapen_KIWA", rscript = rscript1,
schedule = "DAILY",
starttime = "09:05",
startdate = format(Sys.Date()+1, "%d/%m/%Y"))
taskscheduler_delete("run_scrapen_KIWA")
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA_dagelijks.R"
taskscheduler_create(taskname = "run_scrapen_KIWA", rscript = rscript1,
schedule = "DAILY",
starttime = "09:05",
startdate = format(Sys.Date()+1, "%d/%m/%Y"))
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA.R"
## Runnen script automatisch schedulen -----------------------------------------------------------------------
rscript1 = "C:/Users/omwekr02/Documents/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA.R"
taskscheduler_create(taskname = "run_scrapen_KIWA", rscript = rscript1,
schedule = "DAILY",
starttime = "09:05",
startdate = format(Sys.Date()+1, "%d/%m/%Y"))
setwd("~/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data")
source('~/Scrapen_scheduled_tasks/Test_dashboard/Test_app_EK/data/Scrapen_KIWA.R', echo=TRUE)
View(data_totaal)
remDr$close()
